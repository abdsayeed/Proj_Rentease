
    <div class="dashboard-container">
      <div class="dashboard-header">
        <h1>My Dashboard</h1>
        <p>Welcome back, {{ user()?.first_name }}! üëã</p>
      </div>

      <div class="dashboard-grid">
        <!-- Profile Section -->
        <div class="profile-section">
          <app-card>
            <div header>
              <h2>Profile Information</h2>
            </div>
            <div body>
              @if (loading()) {
                <app-skeleton-loader variant="text" [repeat]="5" />
              } @else if (user()) {
                <div class="profile-content">
                  <div class="profile-picture-section">
                    <div class="avatar-wrapper">
                      @if (user()!.profile_picture) {
                        <img [src]="user()!.profile_picture" [alt]="user()!.first_name" class="avatar" />
                      } @else {
                        <div class="avatar-placeholder">
                          {{ user()!.first_name.charAt(0) }}{{ user()!.last_name.charAt(0) }}
                        </div>
                      }
                    </div>
                    <div class="picture-actions">
                      <input 
                        #fileInput 
                        type="file" 
                        accept="image/*" 
                        (change)="onProfilePictureSelected($event)"
                        style="display: none"
                      />
                      <app-button 
                        variant="outline" 
                        size="sm"
                        (clicked)="fileInput.click()"
                        [loading]="uploadingPicture()"
                      >
                        Change Photo
                      </app-button>
                    </div>
                  </div>

                  @if (!editMode()) {
                    <div class="profile-details">
                      <div class="detail-item">
                        <span class="label">Name:</span>
                        <span class="value">{{ user()!.first_name }} {{ user()!.last_name }}</span>
                      </div>
                      <div class="detail-item">
                        <span class="label">Email:</span>
                        <span class="value">{{ user()!.email }}</span>
                      </div>
                      <div class="detail-item">
                        <span class="label">Phone:</span>
                        <span class="value">{{ user()!.phone || 'Not provided' }}</span>
                      </div>
                      <div class="detail-item">
                        <span class="label">Role:</span>
                        <span class="value badge" [class]="user()!.role.toLowerCase()">
                          {{ user()!.role }}
                        </span>
                      </div>
                      <div class="detail-item">
                        <span class="label">Member since:</span>
                        <span class="value">{{ user()!.created_at | date: 'mediumDate' }}</span>
                      </div>
                    </div>
                    <app-button variant="primary" (clicked)="enableEditMode()">
                      Edit Profile
                    </app-button>
                  } @else {
                    <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="profile-form">
                      <div class="form-group">
                        <label for="first_name">First Name</label>
                        <input id="first_name" type="text" formControlName="first_name" />
                        @if (profileForm.get('first_name')?.invalid && profileForm.get('first_name')?.touched) {
                          <span class="error">First name is required</span>
                        }
                      </div>

                      <div class="form-group">
                        <label for="last_name">Last Name</label>
                        <input id="last_name" type="text" formControlName="last_name" />
                        @if (profileForm.get('last_name')?.invalid && profileForm.get('last_name')?.touched) {
                          <span class="error">Last name is required</span>
                        }
                      </div>

                      <div class="form-group">
                        <label for="email">Email</label>
                        <input id="email" type="email" formControlName="email" />
                        @if (profileForm.get('email')?.invalid && profileForm.get('email')?.touched) {
                          <span class="error">Valid email is required</span>
                        }
                      </div>

                      <div class="form-group">
                        <label for="phone">Phone</label>
                        <input id="phone" type="tel" formControlName="phone" />
                      </div>

                      @if (errorMessage()) {
                        <div class="error-message">{{ errorMessage() }}</div>
                      }

                      <div class="form-actions">
                        <app-button 
                          type="submit" 
                          variant="primary"
                          [loading]="saving()"
                          [disabled]="!profileForm.valid"
                        >
                          Save Changes
                        </app-button>
                        <app-button 
                          type="button"
                          variant="outline" 
                          (clicked)="cancelEdit()"
                          [disabled]="saving()"
                        >
                          Cancel
                        </app-button>
                      </div>
                    </form>
                  }
                </div>
              }
            </div>
          </app-card>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
          <div class="stats-grid">
            <app-card [hoverable]="false">
              <div body>
                <div class="stat-card">
                  <div class="stat-icon">üìÖ</div>
                  <div class="stat-value">{{ bookings().length }}</div>
                  <div class="stat-label">Total Bookings</div>
                </div>
              </div>
            </app-card>

            <app-card [hoverable]="false">
              <div body>
                <div class="stat-card">
                  <div class="stat-icon">‚ù§Ô∏è</div>
                  <div class="stat-value">{{ favorites().length }}</div>
                  <div class="stat-label">Saved Properties</div>
                </div>
              </div>
            </app-card>

            <app-card [hoverable]="false">
              <div body>
                <div class="stat-card">
                  <div class="stat-icon">‚è≥</div>
                  <div class="stat-value">{{ upcomingBookingsCount() }}</div>
                  <div class="stat-label">Upcoming Trips</div>
                </div>
              </div>
            </app-card>
          </div>
        </div>

        <!-- Recent Bookings Section -->
        <div class="bookings-section">
          <app-card>
            <div header>
              <div class="section-header">
                <h2>Recent Bookings</h2>
                <app-button variant="outline" size="sm" [routerLink]="['/user/bookings']">
                  View All
                </app-button>
              </div>
            </div>
            <div body>
              @if (loadingBookings()) {
                <app-skeleton-loader variant="list" [repeat]="3" />
              } @else if (bookings().length === 0) {
                <div class="empty-state">
                  <p>You haven't made any bookings yet.</p>
                  <app-button variant="primary" [routerLink]="['/properties']">
                    Browse Properties
                  </app-button>
                </div>
              } @else {
                <div class="bookings-list">
                  @for (booking of recentBookings(); track booking._id) {
                    <div class="booking-item">
                      <div class="booking-info">
                        <div class="booking-dates">
                          <span class="date">{{ booking.check_in_date | date: 'mediumDate' }}</span>
                          <span class="arrow">‚Üí</span>
                          <span class="date">{{ booking.check_out_date | date: 'mediumDate' }}</span>
                        </div>
                        <div class="booking-details">
                          <span class="guests">{{ booking.number_of_guests }} guests</span>
                          <span class="separator">‚Ä¢</span>
                          <span class="price">\${{ booking.total_price }}</span>
                        </div>
                      </div>
                      <div class="booking-status">
                        <span class="status-badge" [class]="booking.status.toLowerCase()">
                          {{ booking.status }}
                        </span>
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          </app-card>
        </div>

        <!-- Favorites Section -->
        <div class="favorites-section">
          <app-card>
            <div header>
              <div class="section-header">
                <h2>Saved Properties</h2>
                <app-button variant="outline" size="sm" [routerLink]="['/user/favorites']">
                  View All
                </app-button>
              </div>
            </div>
            <div body>
              @if (loadingFavorites()) {
                <app-skeleton-loader variant="card" [repeat]="3" />
              } @else if (favorites().length === 0) {
                <div class="empty-state">
                  <p>You haven't saved any properties yet.</p>
                  <app-button variant="primary" [routerLink]="['/properties']">
                    Explore Properties
                  </app-button>
                </div>
              } @else {
                <div class="favorites-grid">
                  @for (property of recentFavorites(); track property._id) {
                    <div class="favorite-card">
                      <img [src]="property.images[0]" [alt]="property.title" class="favorite-image" />
                      <div class="favorite-content">
                        <h4>{{ property.title }}</h4>
                        <p class="location">üìç {{ property.location.city }}</p>
                        <div class="favorite-footer">
                          <span class="price">\${{ property.price_per_night }}/night</span>
                          <app-button 
                            variant="outline" 
                            size="sm" 
                            [routerLink]="['/properties', property._id]"
                          >
                            View
                          </app-button>
                        </div>
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          </app-card>
        </div>
      </div>
    </div>
  